# Алгоритм проверки, является ли граф интервальным

## Основные понятия

### Что такое интервальный граф?

**Определение**: Интервальный граф — это граф, вершины которого можно поставить в соответствие отрезкам на прямой линии, так что рёбра соединяют только те вершины, чьи отрезки пересекаются.

**Пример**: Если вершины графа соответствуют отрезкам $[a_i, b_i]$ на числовой прямой, то ребро между вершинами $v_i$ и $v_j$ существует, если и только если отрезки $[a_i, b_i]$ и $[a_j, b_j]$ имеют непустое пересечение.

### Хордальные графы

**Определение**: Хордальный граф — это граф, в котором любой цикл длины 4 или более имеет хорду, то есть ребро, соединяющее две несоседние вершины цикла. Иными словами, в хордальном графе нет индуцированных циклов длины $\geq 4$.

**Пример**: Граф $K_3$ (треугольник) хордальный, так как у него нет циклов длины $\geq 4$. Граф $C_4$ (цикл из 4 вершин без хорд) не хордальный.

### Совершенный порядок вершин

**Определение**: Совершенный порядок устранения (Perfect Elimination Order, PEO) — это упорядочивание вершин графа $(v_1, v_2, \ldots, v_n)$, такое что для каждой вершины $v_i$ её правые соседи (вершины $v_j$ с $j > i$, смежные с $v_i$) образуют клику.

**Свойство**: Граф хордальный тогда и только тогда, когда он имеет совершенный порядок устранения.

## Теоремы и леммы

### Теорема 1: Хордальность интервальных графов
**Утверждение**: Все интервальные графы являются хордальными.

**Доказательство** (набросок): Предположим, что граф интервальный, и каждая вершина соответствует отрезку $[a_i, b_i]$. Если в графе существует индуцированный цикл длины $\geq 4$, например $v_1 \to v_2 \to v_3 \to v_4 \to v_1$, то отрезки $[a_1, b_1], [a_2, b_2], [a_3, b_3], [a_4, b_4]$ должны пересекаться попарно (1 с 2, 2 с 3, 3 с 4, 4 с 1), но не все вместе (иначе есть хорда). Однако на числовой прямой невозможно расположить четыре отрезка так, чтобы они образовывали цикл без дополнительных пересечений (например, отрезки 1 и 3 пересекаются из-за транзитивности пересечений). Это противоречие показывает, что индуцированный цикл невозможен, следовательно, граф хордальный.

### Теорема 2: Совершенный порядок и Lex-BFS
**Утверждение**: Для хордального графа алгоритм лексикографического поиска в ширину (Lex-BFS) всегда возвращает совершенный порядок устранения.

**Доказательство** (набросок): Lex-BFS нумерует вершины, присваивая каждой вершине метку на основе номеров уже обработанных соседей. В хордальном графе структура клик позволяет Lex-BFS выбирать вершины так, что правые соседи каждой вершины образуют клику, что соответствует определению PEO. Формальное доказательство опирается на свойство минимального разделителя в хордальных графах.
### 2. Свойство минимальных разделителей в хордальных графах
Теорема
В хордальном графе любой минимальный разделитель является кликой.
Пояснение:
Пусть
S — минимальный разделитель, разрывающий связность между двумя вершинами
u и
v.

Если
S не клика, то в нём есть две вершины
a и
b, не соединённые ребром.

Поскольку
S минимален, то:

- a соединена с некоторой вершиной в компоненте
u .
- b соединена с некоторой вершиной в компоненте
v.

Тогда можно построить индуцированный цикл длины ≥4 (через
a,
u-компоненту,
b,
v-компоненту и обратно), но это противоречит хордальности графа.

Значит,
S должен быть кликой.

### Лемма 1: Характеризация интервальных графов
**Утверждение**: Граф является интервальным тогда и только тогда, когда он хордальный, и его максимальные клики можно упорядочить в последовательность $C_1, C_2, \ldots, C_k$, такую что:
1. Соседние клики $C_i$ и $C_{i+1}$ имеют непустое пересечение.
2. Для каждой вершины $v$ множество индексов клик, содержащих $v$, образует непрерывный интервал $[l, r]$.

**Доказательство** (набросок):
- **Необходимость**: Если граф интервальный, его клики соответствуют максимальным наборам пересекающихся отрезков. Эти наборы можно упорядочить вдоль прямой, обеспечивая пересечение соседних клик и непрерывность индексов для каждой вершины.
- **Достаточность**: Если клики упорядочены как путь с непрерывными индексами, можно построить отрезки для вершин, где каждая вершина $v$ получает отрезок, охватывающий позиции её клик в последовательности. Это обеспечивает интервальное представление.

## Пошаговый алгоритм проверки

Алгоритм проверяет, является ли граф интервальным, используя свойства хордальности и расположения клик.

### Шаг 1: Составление списка соседей
Для каждой вершины \(v\) формируем множество \(N(v)\) — список вершин, смежных с \(v\).

### Шаг 2: Лексикографический поиск в ширину (Lex-BFS)
Выполняем Lex-BFS для получения порядка вершин:
- Инициализируем метки всех вершин (изначально пустые).
- На каждом шаге выбираем вершину с лексикографически максимальной меткой.
- После выбора вершины \(v\) добавляем её номер к меткам всех её необработанных соседей.
- Формируем порядок $\sigma = [v_1, v_2, \ldots, v_n]$.

### Шаг 3: Проверка порядка на совершенность
Проверяем, является ли $\sigma$ совершенным порядком устранения:
- Для каждой вершины $v_i$ в порядке:
    - Собираем правых соседей: $N_R(v_i) = \{ v_j \mid j > i, (v_i, v_j) \in E \}$.
    - Проверяем, что $N_R(v_i)$ образует клику: для любых $u, w \in N_R(v_i)$ должно быть ребро $(u, w)$.
- Если для какой-либо вершины $N_R(v_i)$ не клика, граф не хордальный, возвращаем `false`.

### Шаг 4: Поиск максимальных клик
Используя порядок $\sigma$, находим все максимальные клики:
- Для каждой вершины $v_i$, рассматриваем её правых соседей $N_R(v_i)$.
- Проверяем все подмножества $N_R(v_i) \cup \{v_i\}$ на то, являются ли они кликами.
- Проверяем максимальность: клика не должна быть подмножеством большей клики.
- Добавляем изолированные вершины как клики размера 1, если необходимо.

### Шаг 5: Проверка расположения клик
Проверяем, образуют ли максимальные клики путь:
- Строим граф пересечений клик: вершины — клики, рёбра — между кликами с непустым пересечением.
- Проверяем, является ли граф пересечений деревом (с помощью BFS) и путём (линейной структурой).
- Для каждого пути в графе пересечений проверяем, что для каждой вершины $v$ индексы клик, содержащих $v$, образуют непрерывный интервал.
- Если существует такой путь, возвращаем `true`; иначе `false`.

## Почему алгоритм работает?
- Хордальность: Теорема 1 гарантирует, что интервальный граф хордальный. Проверка PEO (шаг 3) подтверждает хордальность.
- Lex-BFS: Теорема 2 обеспечивает, что Lex-BFS даёт PEO для хордальных графов, что упрощает поиск клик.
- Расположение клик: Лемма 1 утверждает, что интервальный граф имеет клики, упорядоченные как путь с непрерывными индексами. Шаг 5 проверяет это свойство.